$((function(){function o(){$("form.login p.error, form.register p.error").remove(),$("form.login input, form.register input").removeClass("error")}function t(o){$(".register h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach((function(o){$("input[name="+o+"]").addClass("error")}))}function e(o){$(".login h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach((function(o){$("input[name="+o+"]").addClass("error")}))}$(".switch-button").on("click",(function(t){t.preventDefault(),$("input").val(""),o(),$(".login").toggle(),$(".register").toggle()})),$("form.login input, form.register input").on("focus",(function(){o()})),$(".register-button").on("click",(function(e){e.preventDefault(),o();const r={login:$("#register-login").val(),password:$("#register-password").val(),passwordConfirm:$("#register-password-confirm").val()};if(r.login&&r.password&&r.passwordConfirm)/^[a-zA-Z0-9]+$/.test(r.login)?r.login.length<3||r.login.length>16?t({error:"Длина логина от 3 до 16 символов!",fields:["login"]}):r.password!==r.passwordConfirm?t({error:"Пароли не совпадают!",fields:["password","passwordConfirm"]}):r.password.length<5?t({error:"Минимальная длина пароля 5 символов!",fields:["password"]}):$.ajax({type:"POST",data:JSON.stringify(r),contentType:"application/json",url:"/api/auth/register"}).done((function(o){o.ok?$(location).attr("href","/"):t(o)})):t({error:"Только латинские буквы и цифры!",fields:["login"]});else{const o=[];r.login||o.push("login"),r.password||o.push("password"),r.passwordConfirm||o.push("passwordConfirm"),t({error:"Все поля должны быть заполнены!",fields:o})}})),$(".login-button").on("click",(function(t){t.preventDefault(),o();const r={login:$("#login-login").val(),password:$("#login-password").val()};if(r.login&&r.password)$.ajax({type:"POST",data:JSON.stringify(r),contentType:"application/json",url:"/api/auth/login"}).done((function(o){o.ok?$(location).attr("href","/"):e(o)}));else{const o=[];r.login||o.push("login"),r.password||o.push("password"),e({error:"Все поля должны быть заполнены!",fields:o})}}))})),$((function(){function o(){$(".post-form p.error").remove(),$(".post-form input, #post-body").removeClass("error")}function t(o){$(".post-form h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach((function(o){$("#post-"+o).addClass("error")}))}$(".post-form input, #post-body").on("focus",(function(){o()})),$(".publish-button, .save-button").on("click",(function(e){e.preventDefault(),o();let r="save-button"===$(this).attr("class").split(" ")[0];const n={title:$("#post-title").val(),body:$("#post-body").val(),isDraft:r,postId:$("#post-id").val()};if(n.title&&n.body)n.title.length<3||n.title.length>64?t({error:"Длина заголовка от 3 до 64 символов!",fields:["title"]}):n.body.replace(/<\/?[^>]+(>|$)/g,"").length<3?t({error:"Текст не менее 3х символов!",fields:["body"]}):$.ajax({type:"POST",data:JSON.stringify(n),contentType:"application/json",url:"/post/add"}).done((function(o){console.log(o),o.ok?r?$(location).attr("href","/post/edit/"+o.post.id):$(location).attr("href","/posts/"+o.post.url):t(o)}));else{const o=[];n.title||o.push("title"),n.body||o.push("body"),t({error:"Все поля должны быть заполнены!",fields:o})}})),$("#file").on("change",(function(){let o=new FormData;o.append("postId",$("#post-id").val()),o.append("file",$("#file")[0].files[0]),$.ajax({type:"POST",url:"/upload/image",data:o,processData:!1,contentType:!1,success:function(o){console.log(o),$("#fileinfo").prepend('<div class="img-container"><img src="/uploads'+o.filePath+'" alt="" /></div>')},error:function(o){console.log(o)}})})),$(".img-container").on("click",(function(){let o=$(this).attr("id"),t=$("#post-body"),e=t[0].selectionStart,r=t.val(),n='<img src="'+o+'" alt="img">';t.val(r.substring(0,e)+n+r.substring(e))}))})),$((function(){let o,t;function e(t){void 0===t.error&&(t.error="Неизвестная ошибка!"),$(o).prepend('<p class="error">'+t.error+"</p>")}function r(e,r){if($(".reply").show(),o&&o.remove(),t=null,o=$(".comment").clone(!0,!0),e)o.find(".cancel").hide(),o.appendTo(".comment-list");else{const e=$(r).parent();t=e.attr("id"),$(r).after(o)}o.css({display:"flex"})}r(!0),$(".reply").on("click",(function(){r(!1,this),$(this).hide()})),$("form.comment .cancel").on("click",(function(t){t.preventDefault(),o.remove(),r(!0)})),$("form.comment .send").on("click",(function(n){n.preventDefault();const i={post:$(".comments").attr("id"),body:o.find("textarea").val(),parent:t};i.body?$.ajax({type:"POST",data:JSON.stringify(i),contentType:"application/json",url:"/comment/add"}).done((function(t){if(console.log(t),t.ok){const e='<ul><li style="background-color:#ffffe0;"><div class="head"><a href="/users/'+t.login+'">'+t.login+'</a><spam class="date">Только что</spam></div>'+t.body+"</li></ul>";$(o).after(e),r(!0)}else e(t)})):e({error:"Коментарий пуст !"})}))}));